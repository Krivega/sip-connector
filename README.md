# sip-connector

[![npm](https://img.shields.io/npm/v/sip-connector?style=flat-square)](https://www.npmjs.com/package/sip-connector)
![npm bundle size](https://img.shields.io/bundlephobia/minzip/sip-connector?style=flat-square)

---

## üìñ –û–ø–∏—Å–∞–Ω–∏–µ

**sip-connector** ‚Äî —ç—Ç–æ TypeScript SDK –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ WebRTC-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π Vinteo —á–µ—Ä–µ–∑ SIP-–ø—Ä–æ—Ç–æ–∫–æ–ª. –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ –±–∞–∑–µ `@krivega/jssip` –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π API –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –≤–∏–¥–µ–æ–∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–π.

### üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

SDK –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è:

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è                    | –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏                                                                                                            |
| ---------------------------- | ---------------------------------------------------------------------------------------------------------------------- |
| **SIP-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è**          | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (SIP REGISTER), —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏                                                             |
| **WebRTC-–∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏**      | –ò—Å—Ö–æ–¥—è—â–∏–µ/–≤—Ö–æ–¥—è—â–∏–µ –∑–≤–æ–Ω–∫–∏ (SIP INVITE/200 OK), –º–µ–¥–∏–∞-–ø–æ—Ç–æ–∫–∏, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ transceiver'–∞–º–∏, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ ICE |
| **–ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏**              | –û—Ç–ø—Ä–∞–≤–∫–∞ –≤—Ç–æ—Ä–æ–≥–æ –ø–æ—Ç–æ–∫–∞ (screen sharing, –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —ç–∫—Ä–∞–Ω–∞)                                                          |
| **–°–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è**      | DTMF, SIP INFO, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–¥–∏–∞-—Å–æ—Å—Ç–æ—è–Ω–∏—è                                                                          |
| **–°–æ–±—ã—Ç–∏–π–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**   | –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏                                                                       |
| **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**               | WebRTC-—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (RTCRtpStats, ICE candidate stats)                                                                   |
| **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—è–º–∏** | –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –º–µ–∂–¥—É —Ä–æ–ª—è–º–∏ (—É—á–∞—Å—Ç–Ω–∏–∫/–∑—Ä–∏—Ç–µ–ª—å)                                                                 |
| **–õ–∏—Ü–µ–Ω–∑–∏—Ä–æ–≤–∞–Ω–∏–µ**           | –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ª–∏—Ü–µ–Ω–∑–∏–π –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π                                                              |
| **–ê–≤—Ç–æ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ**          | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –æ–±—Ä—ã–≤–∞—Ö —Å–≤—è–∑–∏                                                                       |

- **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π polling**: –£–ª—É—á—à–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ–ø—Ä–æ—Å–∞ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤–∏–¥–µ–æ—Ç—Ä–µ–∫–æ–≤
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ maxBitrate –≤ PresentationManager**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∏—Ç—Ä–µ–π—Ç–æ–º –¥–ª—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π
- **–ü—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–¥–µ–∫–∏ –≤ SipConnector**: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ –∫–æ–¥–µ–∫–æ–≤ –Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–∞
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–º–µ–Ω—ã —Ç—Ä–µ–∫–æ–≤**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤–∏–¥–µ–æ—Ç—Ä–µ–∫–æ–≤
- **–£–ª—É—á—à–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**: –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Å–±–æ—Ä–∞ –∏ –∞–Ω–∞–ª–∏–∑–∞ WebRTC —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ ICE**: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π `restart` –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –≤—ã–∑–æ–≤–æ–º `restartIce`
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ transceiver'–∞–º–∏**: –ù–æ–≤—ã–π `TransceiverManager` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è RTCRtpTransceiver'–∞–º–∏
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ transceiver'–æ–≤**: –£–º–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–æ–Ω–Ω—ã—Ö transceiver'–æ–≤ –ø—Ä–∏ —Å–æ–±—ã—Ç–∏—è—Ö restart
  |

### üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

SDK –ø–æ—Å—Ç—Ä–æ–µ–Ω –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É **—Å–ª–æ–∏—Å—Ç–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã**:

- **SipConnector** ‚Äî –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π —Å–ª–æ–π —Å –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º–∏ (Connection, Call, Presentation, API, AutoConnector)
- **SipConnectorFacade** ‚Äî –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π —Ñ–∞—Å–∞–¥ —Å –≥–æ—Ç–æ–≤—ã–º–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è–º–∏
- **–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–µ–Ω–µ–¥–∂–µ—Ä—ã** ‚Äî –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏, —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤, –º–µ–¥–∏–∞-–ø–æ—Ç–æ–∫–æ–≤, –∞–≤—Ç–æ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

---

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –ö–æ–º–∞–Ω–¥—ã —É—Å—Ç–∞–Ω–æ–≤–∫–∏

```bash
# npm
npm install sip-connector

# yarn
yarn add sip-connector

# pnpm
pnpm add sip-connector
```

---

## üéØ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –®–∞–≥ 1: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

```typescript
import { UA, WebSocketInterface } from '@krivega/jssip';
import { SipConnector, SipConnectorFacade, tools } from 'sip-connector';

// –°–æ–∑–¥–∞–Ω–∏–µ –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤–æ–≥–æ –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–∞ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –∫–æ–¥–µ–∫–æ–≤
const sipConnector = new SipConnector(
  { JsSIP: { UA, WebSocketInterface } },
  {
    // –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∫–æ–¥–µ–∫–æ–≤
    preferredMimeTypesVideoCodecs: ['video/AV1', 'video/VP9'],
    excludeMimeTypesVideoCodecs: ['video/H264'],
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∏–¥–µ–æ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    videoBalancerOptions: {
      ignoreForCodec: 'H264',
      onSetParameters: (result) => {
        console.log('Video parameters updated:', result);
      },
    },
  },
);

// –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞—Å–∞–¥–∞
const facade = new SipConnectorFacade(sipConnector);
```

### –®–∞–≥ 2: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É

```typescript
await facade.connectToServer({
  userAgent: tools.getUserAgent({ appName: 'MyApp' }),
  sipWebSocketServerURL: 'wss://sip.example.com/ws',
  sipServerUrl: 'sip:example.com',
  name: '1001', // SIP URI user part
  password: 'secret',
  isRegisteredUser: true, // –í–∫–ª—é—á–∏—Ç—å SIP REGISTER
});
```

### –®–∞–≥ 3: –ò—Å—Ö–æ–¥—è—â–∏–π –∑–≤–æ–Ω–æ–∫

```typescript
// –ü–æ–ª—É—á–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –º–µ–¥–∏–∞-–ø–æ—Ç–æ–∫–∞
const localStream = await navigator.mediaDevices.getUserMedia({
  audio: true,
  video: true,
});

// –ò–Ω–∏—Ü–∏–∞—Ü–∏—è –∑–≤–æ–Ω–∫–∞
const pc = await facade.callToServer({
  conference: '12345',
  mediaStream: localStream,
  setRemoteStreams: (streams) => {
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤
    console.log('–ü–æ–ª—É—á–µ–Ω—ã —É–¥–∞–ª–µ–Ω–Ω—ã–µ –ø–æ—Ç–æ–∫–∏:', streams);
  },
});

// –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ WebRTC-—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
const unsubscribeStats = facade.onStats(({ outbound, inbound }) => {
  console.log('–ò—Å—Ö–æ–¥—è—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:', outbound);
  console.log('–í—Ö–æ–¥—è—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:', inbound);
});
```

### –®–∞–≥ 4: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã

```typescript
await facade.disconnectFromServer();
unsubscribeStats();
```

---

## üìû –í—Ö–æ–¥—è—â–∏–µ –∑–≤–æ–Ω–∫–∏

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥—è—â–∏—Ö –≤—ã–∑–æ–≤–æ–≤

```typescript
// –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–±—ã—Ç–∏—è
sipConnector.on('incoming-call:incomingCall', () => {
  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–≤–µ—Ç —Å –ª–æ–∫–∞–ª—å–Ω—ã–º –ø–æ—Ç–æ–∫–æ–º
  facade.answerToIncomingCall({
    mediaStream: localStream,
    setRemoteStreams: (streams) => {
      // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤
      displayRemoteStreams(streams);
    },
  });
});
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∑–≤–æ–Ω–∫–∞

```typescript
// –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –∑–≤–æ–Ω–∫–∞
sipConnector.on('call:accepted', () => {
  console.log('–ó–≤–æ–Ω–æ–∫ –ø—Ä–∏–Ω—è—Ç');
});

sipConnector.on('call:ended', () => {
  console.log('–ó–≤–æ–Ω–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω');
});

sipConnector.on('call:failed', (error) => {
  console.error('–û—à–∏–±–∫–∞ –∑–≤–æ–Ω–∫–∞:', error);
});
```

---

## üñ•Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è–º–∏

### –ó–∞–ø—É—Å–∫ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏

```typescript
// –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–∞ —ç–∫—Ä–∞–Ω–∞
const displayStream = await navigator.mediaDevices.getDisplayMedia({
  video: true,
  audio: true,
});

// –ó–∞–ø—É—Å–∫ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –∫–∞—á–µ—Å—Ç–≤–∞
await facade.startPresentation({
  mediaStream: displayStream,
  isP2P: false, // MCU —Ä–µ–∂–∏–º
  contentHint: 'detail', // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
  maxBitrate: 4000000, // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –±–∏—Ç—Ä–µ–π—Ç 4 –ú–±–∏—Ç/—Å
  degradationPreference: 'maintain-resolution', // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
  sendEncodings: [
    { width: 1920, height: 1080, scalabilityMode: 'L3T3_KEY' },
    { width: 1280, height: 720 },
  ],
});
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∞

```typescript
// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–∞ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏ —Å –Ω–æ–≤—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
await facade.updatePresentation({
  mediaStream: newDisplayStream,
  isP2P: false,
  maxBitrate: 6000000, // –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π –±–∏—Ç—Ä–µ–π—Ç –¥–ª—è HD –∫–æ–Ω—Ç–µ–Ω—Ç–∞
  contentHint: 'text', // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
});

// –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏
await facade.stopShareSipConnector();
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏

| –ü–∞—Ä–∞–º–µ—Ç—Ä                | –û–ø–∏—Å–∞–Ω–∏–µ                         | –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è                  |
| ----------------------- | -------------------------------- | --------------------------------------- |
| `maxBitrate`            | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –±–∏—Ç—Ä–µ–π—Ç (bps)       | 2-8 –ú–±–∏—Ç/—Å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç–∞    |
| `contentHint`           | –¢–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏     | `'detail'`, `'text'`, `'motion'`        |
| `degradationPreference` | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø—Ä–∏ —É—Ö—É–¥—à–µ–Ω–∏–∏ –∫–∞—á–µ—Å—Ç–≤–∞ | `'maintain-resolution'` –¥–ª—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π |

```typescript
// –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
const presentationSettings = {
  // For detailed graphics/images
  highQuality: {
    maxBitrate: 8000000,
    contentHint: 'detail' as const,
    degradationPreference: 'maintain-resolution' as const,
  },

  // For text documents
  textOptimized: {
    maxBitrate: 4000000,
    contentHint: 'text' as const,
    degradationPreference: 'maintain-resolution' as const,
  },

  // For video content
  videoOptimized: {
    maxBitrate: 6000000,
    contentHint: 'motion' as const,
    degradationPreference: 'maintain-framerate' as const,
  },
};

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
await facade.startPresentation({
  mediaStream: displayStream,
  isP2P: false,
  ...presentationSettings.textOptimized,
});
```

---

## üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏ –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–∏

### –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–π

```typescript
// –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤ –∑—Ä–∏—Ç–µ–ª–∏
const unsubscribeMoveToSpectators = facade.onMoveToSpectators(() => {
  console.log('–£—á–∞—Å—Ç–Ω–∏–∫ –ø–µ—Ä–µ–º–µ—â–µ–Ω –≤ –∑—Ä–∏—Ç–µ–ª–∏');
  updateParticipantRole('spectator');
});

// –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤ —É—á–∞—Å—Ç–Ω–∏–∫–∏
const unsubscribeMoveToParticipants = facade.onMoveToParticipants(() => {
  console.log('–£—á–∞—Å—Ç–Ω–∏–∫ –ø–µ—Ä–µ–º–µ—â–µ–Ω –≤ —É—á–∞—Å—Ç–Ω–∏–∫–∏');
  updateParticipantRole('participant');
});

// –û—Ç–ø–∏—Å–∫–∞ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
unsubscribeMoveToSpectators();
unsubscribeMoveToParticipants();
```

### –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

```typescript
// –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏
facade.onMustStopPresentation(() => {
  console.log('–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Ç—Ä–µ–±—É–µ—Ç –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—é');
  facade.stopShareSipConnector();
});

// –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–∏—Ü–µ–Ω–∑–∏–π
facade.onUseLicense((license) => {
  console.log('–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏—Ü–µ–Ω–∑–∏—è:', license);
  updateLicenseStatus(license);
});
```

---

## üìä –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ–¥–∏–∞-–ø–æ—Ç–æ–∫–∞–º–∏

### –†–∞–±–æ—Ç–∞ —Å —É–¥–∞–ª–µ–Ω–Ω—ã–º–∏ –ø–æ—Ç–æ–∫–∞–º–∏

```typescript
// –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö —É–¥–∞–ª–µ–Ω–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤
const remoteStreams = facade.getRemoteStreams();
if (remoteStreams) {
  console.log('–ê–∫—Ç–∏–≤–Ω—ã–µ —É–¥–∞–ª–µ–Ω–Ω—ã–µ –ø–æ—Ç–æ–∫–∏:', remoteStreams.length);
  remoteStreams.forEach((stream) => {
    displayStream(stream);
  });
}
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –≥–æ—Ç–æ–≤—ã—Ö –ø–æ—Ç–æ–∫–æ–≤

```typescript
// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å debounce (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è UI)
const handleReadyRemoteStreamsDebounced = facade.resolveHandleReadyRemoteStreamsDebounced({
  onReadyRemoteStreams: (streams) => {
    console.log('–ì–æ—Ç–æ–≤—ã–µ —É–¥–∞–ª–µ–Ω–Ω—ã–µ –ø–æ—Ç–æ–∫–∏:', streams);
    updateStreamsDisplay(streams);
  },
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –±–µ–∑ debounce (–¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π)
const handleReadyRemoteStreams = facade.resolveHandleReadyRemoteStreams({
  onReadyRemoteStreams: () => {
    console.log('–ù–æ–≤—ã–π –ø–æ—Ç–æ–∫ –≥–æ—Ç–æ–≤');
    handleNewStream();
  },
});
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è–º–∏

```typescript
// –ó–∞–ø—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ –∫–∞–º–µ—Ä—É
try {
  await facade.askPermissionToEnableCam();
  console.log('–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –∫–∞–º–µ—Ä—É –ø–æ–ª—É—á–µ–Ω–æ');
} catch (error) {
  console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è:', error);
}
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ ICE-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

#### –†—É—á–Ω–æ–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫

```typescript
// –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ ICE –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
try {
  const success = await sipConnector.callManager.restartIce({
    useUpdate: true, // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SIP UPDATE –≤–º–µ—Å—Ç–æ re-INVITE
    extraHeaders: ['X-Restart-Reason: Connection-Reset'],
    rtcOfferConstraints: {
      offerToReceiveAudio: true,
      offerToReceiveVideo: true,
    },
  });

  if (success) {
    console.log('ICE –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω —É—Å–ø–µ—à–Ω–æ');
  } else {
    console.warn('–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ ICE –Ω–µ —É–¥–∞–ª—Å—è');
  }
} catch (error) {
  console.error('–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ ICE:', error);
}
```

#### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø–æ —Å–æ–±—ã—Ç–∏—é —Å–µ—Ä–≤–µ—Ä–∞

SDK –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è `restart` –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞ –∏ –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ ICE-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º transceiver'–∞–º–∏:

```typescript
// SDK –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏—è restart –æ—Ç ApiManager
// –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è:
// 1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ transceiver'–∞
// 2. –í—ã–∑—ã–≤–∞–µ—Ç callManager.restartIce()

// –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ–±—ã—Ç–∏–π restart (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
sipConnector.on('api:restart', (data) => {
  console.log('–ü–æ–ª—É—á–µ–Ω–æ —Å–æ–±—ã—Ç–∏–µ restart –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', {
    tracksDirection: data.tracksDirection, // 'incoming', 'outgoing', 'bidirectional'
    audioTrackCount: data.audioTrackCount,
    videoTrackCount: data.videoTrackCount,
  });

  // SDK –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
  // - –î–æ–±–∞–≤–∏—Ç –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–æ–Ω–Ω—ã–π transceiver –µ—Å–ª–∏ videoTrackCount === 2
  // - –í—ã–∑–æ–≤–µ—Ç restartIce()
  console.log('ICE –±—É–¥–µ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏');

  if (data.videoTrackCount === 2) {
    console.log('–ú–æ–∂–µ—Ç –±—ã—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–æ–Ω–Ω—ã–π transceiver');
  }
});
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ ICE

| –ü–∞—Ä–∞–º–µ—Ç—Ä                | –¢–∏–ø      | –û–ø–∏—Å–∞–Ω–∏–µ                                 | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
| ----------------------- | -------- | ---------------------------------------- | ------------ |
| `useUpdate`             | boolean  | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SIP UPDATE –≤–º–µ—Å—Ç–æ re-INVITE | `false`      |
| `extraHeaders`          | string[] | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ SIP –∑–∞–≥–æ–ª–æ–≤–∫–∏             | `[]`         |
| `rtcOfferConstraints`   | object   | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è SDP offer       | `{}`         |
| `sendEncodings`         | array    | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –≤–∏–¥–µ–æ–ø–æ—Ç–æ–∫–∞    | `[]`         |
| `degradationPreference` | string   | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø—Ä–∏ —É—Ö—É–¥—à–µ–Ω–∏–∏ –∫–∞—á–µ—Å—Ç–≤–∞         | `undefined`  |

---

## üéõÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ RTCRtpTransceiver'–∞–º–∏

### –û–±–∑–æ—Ä TransceiverManager

SDK –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç RTCRtpTransceiver'–∞–º–∏ —á–µ—Ä–µ–∑ –Ω–æ–≤—ã–π –∫–ª–∞—Å—Å `TransceiverManager`:

```typescript
// –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö transceiver'–æ–≤
const transceivers = sipConnector.callManager.getTransceivers();

console.log('–û—Å–Ω–æ–≤–Ω–æ–π –∞—É–¥–∏–æ transceiver:', transceivers.mainAudio);
console.log('–û—Å–Ω–æ–≤–Ω–æ–π –≤–∏–¥–µ–æ transceiver:', transceivers.mainVideo);
console.log('–ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–æ–Ω–Ω—ã–π –≤–∏–¥–µ–æ transceiver:', transceivers.presentationVideo);
```

### –¢–∏–ø—ã transceiver'–æ–≤

SDK –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç transceiver'—ã –ø–æ –∏—Ö `mid` –∑–Ω–∞—á–µ–Ω–∏—é:

| –¢–∏–ø transceiver'–∞   | mid | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                  |
| ------------------- | --- | --------------------------- |
| `mainAudio`         | '0' | –û—Å–Ω–æ–≤–Ω–æ–π –∞—É–¥–∏–æ –ø–æ—Ç–æ–∫        |
| `mainVideo`         | '1' | –û—Å–Ω–æ–≤–Ω–æ–π –≤–∏–¥–µ–æ –ø–æ—Ç–æ–∫        |
| `presentationVideo` | '2' | –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–æ–Ω–Ω—ã–π –≤–∏–¥–µ–æ –ø–æ—Ç–æ–∫ |

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ transceiver'–æ–≤

–ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–æ–±—ã—Ç–∏—è `restart` —Å `videoTrackCount === 2`, SDK –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–æ–Ω–Ω—ã–π transceiver –µ—Å–ª–∏ –æ–Ω –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç:

```typescript
// SDK –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è restart
sipConnector.on('api:restart', (data) => {
  if (data.videoTrackCount === 2) {
    // SDK –ø—Ä–æ–≤–µ—Ä–∏—Ç –Ω–∞–ª–∏—á–∏–µ presentationVideo transceiver'–∞
    // –∏ –¥–æ–±–∞–≤–∏—Ç –µ–≥–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ
    console.log('–ë—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–æ–Ω–Ω—ã–π transceiver');
  }
});
```

### –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ transceiver'–∞–º–∏

```typescript
// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ transceiver'–∞
try {
  const audioTransceiver = await sipConnector.callManager.addTransceiver('audio', {
    direction: 'sendrecv',
  });

  const videoTransceiver = await sipConnector.callManager.addTransceiver('video', {
    direction: 'sendonly',
    sendEncodings: [
      { rid: 'low', maxBitrate: 500_000, scaleResolutionDownBy: 4 },
      { rid: 'high', maxBitrate: 2_000_000, scaleResolutionDownBy: 1 },
    ],
  });

  console.log('Transceiver'—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã:', { audioTransceiver, videoTransceiver });
} catch (error) {
  console.error('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è transceiver'–∞:', error);
}
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ transceiver'–æ–≤

```typescript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è transceiver'–æ–≤
const checkTransceivers = () => {
  const transceivers = sipConnector.callManager.getTransceivers();

  console.log('–°—Ç–∞—Ç—É—Å transceiver'–æ–≤:', {
    hasAudio: transceivers.mainAudio !== undefined,
    hasVideo: transceivers.mainVideo !== undefined,
    hasPresentation: transceivers.presentationVideo !== undefined,
  });

  // –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
  if (transceivers.mainVideo) {
    console.log('–û—Å–Ω–æ–≤–Ω–æ–µ –≤–∏–¥–µ–æ:', {
      mid: transceivers.mainVideo.mid,
      direction: transceivers.mainVideo.direction,
      currentDirection: transceivers.mainVideo.currentDirection,
    });
  }
};

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
sipConnector.on('call:confirmed', () => {
  checkTransceivers();
});
```

---

## üì° –°–æ–±—ã—Ç–∏—è –∏ –∏—Ö –æ–±—Ä–∞–±–æ—Ç–∫–∞

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–æ–±—ã—Ç–∏–π

SDK –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **—Å–æ–±—ã—Ç–∏–π–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É** —Å –ø—Ä–µ—Ñ–∏–∫—Å–∞–º–∏ –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏:

| –ü—Ä–µ—Ñ–∏–∫—Å            | –û–ø–∏—Å–∞–Ω–∏–µ                 | –ü—Ä–∏–º–µ—Ä—ã —Å–æ–±—ã—Ç–∏–π                           |
| ------------------ | ------------------------ | ----------------------------------------- |
| `connection:*`     | –°–æ–±—ã—Ç–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è      | `connected`, `disconnected`               |
| `call:*`           | –°–æ–±—ã—Ç–∏—è –∑–≤–æ–Ω–∫–æ–≤          | `accepted`, `ended`, `failed`             |
| `api:*`            | –°–æ–±—ã—Ç–∏—è –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞       | `enterRoom`, `useLicense`, `restart`      |
| `incoming-call:*`  | –°–æ–±—ã—Ç–∏—è –≤—Ö–æ–¥—è—â–∏—Ö –∑–≤–æ–Ω–∫–æ–≤ | `incomingCall`                            |
| `presentation:*`   | –°–æ–±—ã—Ç–∏—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π      | `started`, `stopped`                      |
| `stats:*`          | –°–æ–±—ã—Ç–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏       | `collected`                               |
| `video-balancer:*` | –°–æ–±—ã—Ç–∏—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏     | `balancing-started`, `parameters-updated` |

### –û—Å–Ω–æ–≤–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è

```typescript
// –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
sipConnector.on('connection:connected', () => {
  console.log('–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
});

sipConnector.on('connection:disconnected', () => {
  console.log('–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–∑–æ—Ä–≤–∞–Ω–æ');
});

// –ó–≤–æ–Ω–∫–∏
sipConnector.on('call:accepted', () => {
  console.log('–ó–≤–æ–Ω–æ–∫ –ø—Ä–∏–Ω—è—Ç');
});

sipConnector.on('call:ended', () => {
  console.log('–ó–≤–æ–Ω–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω');
});

// API —Å–æ–±—ã—Ç–∏—è
sipConnector.on('api:enterRoom', ({ room }) => {
  console.log('–í—Ö–æ–¥ –≤ –∫–æ–º–Ω–∞—Ç—É:', room);
});

sipConnector.on('api:useLicense', (license) => {
  console.log('–õ–∏—Ü–µ–Ω–∑–∏—è:', license);
});

sipConnector.on('api:restart', (data) => {
  console.log('–°–æ–±—ã—Ç–∏–µ restart –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', data);
});
```

### –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã

```typescript
// –û–∂–∏–¥–∞–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–æ–±—ã—Ç–∏–π
sipConnector.onceRace(['call:ended', 'call:failed'], (_payload, eventName) => {
  console.log('–ó–≤–æ–Ω–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω —Å–æ–±—ã—Ç–∏–µ–º:', eventName);
  cleanupCall();
});

// –û–∂–∏–¥–∞–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–æ–±—ã—Ç–∏—è
const roomData = await sipConnector.wait('api:enterRoom');
console.log('–î–∞–Ω–Ω—ã–µ –∫–æ–º–Ω–∞—Ç—ã:', roomData);
```

### –°–æ–±—ã—Ç–∏—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –≤–∏–¥–µ–æ

```typescript
// –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –≤–∏–¥–µ–æ
sipConnector.on('video-balancer:balancing-scheduled', (data) => {
  console.log(`–ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∞ —á–µ—Ä–µ–∑ ${data.delay}ms`);
});

sipConnector.on('video-balancer:balancing-started', (data) => {
  console.log(`–ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –∑–∞–ø—É—â–µ–Ω–∞ –ø–æ—Å–ª–µ –∑–∞–¥–µ—Ä–∂–∫–∏ ${data.delay}ms`);
});

sipConnector.on('video-balancer:balancing-stopped', () => {
  console.log('–ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞');
});

sipConnector.on('video-balancer:parameters-updated', (result) => {
  console.log('–û–±–Ω–æ–≤–ª–µ–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:', result);
});

// –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–æ–π
sipConnector.videoSendingBalancerManager.startBalancing(); // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫
sipConnector.videoSendingBalancerManager.stopBalancing(); // –û—Å—Ç–∞–Ω–æ–≤–∫–∞
```

---

## üìà WebRTC –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### –û–±–∑–æ—Ä –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π

SDK –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é WebRTC-—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É, –æ—Å–Ω–æ–≤–∞–Ω–Ω—É—é –Ω–∞ [W3C WebRTC Statistics API](https://www.w3.org/TR/webrtc-stats/), –≤–∫–ª—é—á–∞—é—â—É—é:

| –¢–∏–ø —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏     | –û–ø–∏—Å–∞–Ω–∏–µ              | –ú–µ—Ç—Ä–∏–∫–∏                       |
| ------------------ | --------------------- | ----------------------------- |
| **RTP —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** | –ü–æ—Ç–æ–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ      | –ü–∞–∫–µ—Ç—ã, –±–∞–π—Ç—ã, jitter, loss   |
| **–ö–æ–¥–µ–∫–∏**         | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã, —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è         |
| **ICE –∫–∞–Ω–¥–∏–¥–∞—Ç—ã**  | –°–µ—Ç–µ–≤—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è    | –¢–∏–ø—ã, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã, —Å–æ—Å—Ç–æ—è–Ω–∏—è   |
| **–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç**      | –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è | DTLS, —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è, —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã |

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

```typescript
import { StatsPeerConnection, EStatsTypes, hasAvailableStats } from 'sip-connector';

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
if (hasAvailableStats()) {
  const statsCollector = new StatsPeerConnection();

  // –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
  statsCollector.on('collected', ({ outbound, inbound }) => {
    console.log('–ò—Å—Ö–æ–¥—è—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:', outbound);
    console.log('–í—Ö–æ–¥—è—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:', inbound);

    // –ù–æ–≤–∞—è –º–µ—Ç—Ä–∏–∫–∞ availableIncomingBitrate
    if (inbound.additional?.candidatePair?.availableIncomingBitrate) {
      console.log(
        '–î–æ—Å—Ç—É–ø–Ω—ã–π –≤—Ö–æ–¥—è—â–∏–π –±–∏—Ç—Ä–µ–π—Ç:',
        inbound.additional.candidatePair.availableIncomingBitrate,
      );
    }

    // –ê–Ω–∞–ª–∏–∑ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
    analyzeConnectionQuality(outbound, inbound);
  });

  // –ó–∞–ø—É—Å–∫ —Å–±–æ—Ä–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Å –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–º –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º
  statsCollector.start(peerConnection);
}
```

### –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª —Å–±–æ—Ä–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

SDK –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç —á–∞—Å—Ç–æ—Ç—É —Å–±–æ—Ä–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:

| –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è | –ú–Ω–æ–∂–∏—Ç–µ–ª—å –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ | –ò–Ω—Ç–µ—Ä–≤–∞–ª (–º—Å) |
| ---------------- | ------------------- | ------------- |
| < 16 –º—Å          | 1x                  | 1000          |
| 16-32 –º—Å         | 2x                  | 2000          |
| 32-48 –º—Å         | 3x                  | 3000          |
| > 48 –º—Å          | 4x                  | 4000          |

```typescript
// –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å–±–æ—Ä–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
statsCollector.on('collected', (stats) => {
  const collectionTime = performance.now() - startTime;
  console.log(`–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ–±—Ä–∞–Ω–∞ –∑–∞ ${collectionTime}–º—Å`);
});
```

### –¢–∏–ø—ã —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è              | –¢–∏–ø—ã                              | –û–ø–∏—Å–∞–Ω–∏–µ                                   |
| ---------------------- | --------------------------------- | ------------------------------------------ |
| **–ê—É–¥–∏–æ –ø–æ—Ç–æ–∫–∏**       | `TInboundAudio`, `TOutboundAudio` | RTP, –∫–æ–¥–µ–∫, jitter buffer, audio level     |
| **–í–∏–¥–µ–æ –ø–æ—Ç–æ–∫–∏**       | `TInboundVideo`, `TOutboundVideo` | RTP, –∫–æ–¥–µ–∫, frames, bitrate, resolution    |
| **–°–µ—Ç–µ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è** | `TAdditional`                     | ICE –∫–∞–Ω–¥–∏–¥–∞—Ç—ã, DTLS —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç, —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã |

---

## ‚ö° –ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –æ–ø—Ä–∞—à–∏–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ–ø–æ—Ç–æ–∫–æ–≤

### –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã

SDK –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–∞–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –æ–ø—Ä–∞—à–∏–≤–∞–Ω–∏–µ** –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –≤–∏–¥–µ–æ–ø–æ—Ç–æ–∫–∞—Ö, —á—Ç–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —Å–Ω–∏–∂–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ CPU:

```typescript
// TrackMonitor –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç —á–∞—Å—Ç–æ—Ç—É –æ–ø—Ä–∞—à–∏–≤–∞–Ω–∏—è
const trackMonitor = new TrackMonitor({
  pollIntervalMs: 1000, // –ù–∞—á–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª
  maxPollIntervalMs: 16000, // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª (16x)
});
```

### –ê–ª–≥–æ—Ä–∏—Ç–º –∞–¥–∞–ø—Ç–∞—Ü–∏–∏

| –°–∏—Ç—É–∞—Ü–∏—è                 | –î–µ–π—Å—Ç–≤–∏–µ                        | –†–µ–∑—É–ª—å—Ç–∞—Ç                    |
| ------------------------ | ------------------------------- | ---------------------------- |
| **–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è** | –°–±—Ä–æ—Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –¥–æ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ | –ë—ã—Å—Ç—Ä–∞—è —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è |
| **–ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π**        | –£–¥–≤–æ–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞              | –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ CPU     |
| **–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ –º–∞–∫—Å–∏–º—É–º–∞** | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞           | –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ "–∑–∞–º–æ—Ä–æ–∑–∫–∏"   |

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

- **–°–Ω–∏–∂–µ–Ω–∏–µ CPU –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ 40-60%** –ø—Ä–∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ–º –≤–∏–¥–µ–æ
- **–ë—ã—Å—Ç—Ä–∞—è —Ä–µ–∞–∫—Ü–∏—è** –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è (resize events)
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ** –∑–∞–º–µ–Ω—ã —Ç—Ä–µ–∫–æ–≤ (replaceTrack)
- **–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã** –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```typescript
// –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
const monitor = new TrackMonitor({
  pollIntervalMs: 500, // –ë–æ–ª–µ–µ —á–∞—Å—Ç–æ–µ –Ω–∞—á–∞–ª—å–Ω–æ–µ –æ–ø—Ä–∞—à–∏–≤–∞–Ω–∏–µ
  maxPollIntervalMs: 8000, // –ú–µ–Ω—å—à–∏–π –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª
});

// –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è
monitor.subscribe(videoSender, () => {
  console.log('–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤–∏–¥–µ–æ–ø–æ—Ç–æ–∫–∞');
  // –ü–µ—Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
  rebalanceVideoParameters();
});
```

---

## üéõÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∏–¥–µ–æ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–æ–º

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞

`VideoSendingBalancer` –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ `SipConnector` –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

```typescript
const sipConnector = new SipConnector(
  { JsSIP: { UA, WebSocketInterface } },
  {
    videoBalancerOptions: {
      ignoreForCodec: 'H264', // –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å H264
      onSetParameters: (result) => {
        console.log('–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã:', result);
      },
    },
  },
);

// –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∞
sipConnector.on('video-balancer:balancing-started', (data) => {
  console.log(`–ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –∑–∞–ø—É—â–µ–Ω–∞ —á–µ—Ä–µ–∑ ${data.delay}–º—Å`);
});

sipConnector.on('video-balancer:parameters-updated', (result) => {
  console.log('–û–±–Ω–æ–≤–ª–µ–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:', result);
});
```

### –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∞

```mermaid
graph TD
    A[–ù–∞—á–∞–ª–æ –∑–≤–æ–Ω–∫–∞] --> B[–ó–∞–¥–µ—Ä–∂–∫–∞ 10 —Å–µ–∫]
    B --> C[–ó–∞–ø—É—Å–∫ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏]
    C --> D[–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏–∑–º–µ–Ω–µ–Ω–∏–π]
    D --> E{–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç—Ä–µ–∫–æ–≤?}
    E -->|–î–∞| F[–ü–µ—Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞]
    E -->|–ù–µ—Ç| D
    F --> D
    G[–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–≤–æ–Ω–∫–∞] --> H[–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏]
```

### –°–æ–±—ã—Ç–∏—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∞

| –°–æ–±—ã—Ç–∏–µ                              | –û–ø–∏—Å–∞–Ω–∏–µ                   | –î–∞–Ω–Ω—ã–µ                 |
| ------------------------------------ | -------------------------- | ---------------------- |
| `video-balancer:balancing-scheduled` | –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∞ | `{ delay: number }`    |
| `video-balancer:balancing-started`   | –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –∑–∞–ø—É—â–µ–Ω–∞      | `{ delay: number }`    |
| `video-balancer:balancing-stopped`   | –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞   | -                      |
| `video-balancer:parameters-updated`  | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã        | `RTCRtpSendParameters` |

---

## üîÑ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–º–∏ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏

### ConnectionQueueManager

`ConnectionQueueManager` –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç **–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π** –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –∏ –≥–æ–Ω–∫–∏ —É—Å–ª–æ–≤–∏–π:

```typescript
// –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ ConnectionManager –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥—å
const connectionQueueManager = new ConnectionQueueManager({
  connectionManager: connectionManager,
});

// –û–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
await connectionQueueManager.connect(params);
await connectionQueueManager.disconnect();
```

### –ú–µ—Ö–∞–Ω–∏–∑–º —Ä–∞–±–æ—Ç—ã

- **–û—á–µ—Ä–µ–¥—å –æ–ø–µ—Ä–∞—Ü–∏–π**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `stack-promises` —Å `noRunIsNotActual: true`
- **–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤**: –ò—Å–∫–ª—é—á–∞–µ—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ connect/disconnect –æ–ø–µ—Ä–∞—Ü–∏–∏

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

| –û–ø–µ—Ä–∞—Ü–∏—è     | –û–ø–∏—Å–∞–Ω–∏–µ                          |
| ------------ | --------------------------------- |
| `connect`    | –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É             |
| `disconnect` | –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞             |
| `run`        | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ –≤ –æ—á–µ—Ä–µ–¥—å       |
| `stop`       | –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –≤ –æ—á–µ—Ä–µ–¥–∏ |

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ SipConnector

```typescript
// SipConnector –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç ConnectionQueueManager
const sipConnector = new SipConnector({ JsSIP });

// –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥—å
await sipConnector.connect(params); // ‚Üí connectionQueueManager.connect()
await sipConnector.disconnect(); // ‚Üí connectionQueueManager.disconnect()
```

---

## üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

### AutoConnectorManager

`AutoConnectorManager` –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ** –ø—Ä–∏ –æ–±—Ä—ã–≤–∞—Ö —Å–≤—è–∑–∏ –∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å —Å–µ—Ç—å—é:

```typescript
// –°–æ–∑–¥–∞–Ω–∏–µ SipConnector —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –∞–≤—Ç–æ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
const sipConnector = new SipConnector(
  { JsSIP },
  {
    autoConnectorOptions: {
      clearCache, // –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º
      timeoutBetweenAttempts: 3000, // –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏
      checkTelephonyRequestInterval: 15000, // –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–∏–∏
    },
  },
);

// –ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
sipConnector.startAutoConnect({
  // –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
  getConnectParameters: async () => {
    return {
      sipWebSocketServerURL: 'wss://example.com/ws',
      sipServerUrl: 'sipServerUrl',
    };
  },
  // –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–∏–∏
  getCheckTelephonyParameters: async () => {
    return {
      displayName: 'displayName',
      sipWebSocketServerURL: 'wss://example.com/ws',
      sipServerUrl: 'sipServerUrl',
    };
  },
  // –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é
  hasReadyForConnection: () => {
    return true;
  },
});

// –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–≤—Ç–æ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
sipConnector.stopAutoConnect();

// –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è –∞–≤—Ç–æ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
sipConnector.on('auto-connect:changed-attempt-status', ({ isInProgress }) => {
  console.log('–ü–æ–ø—ã—Ç–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ:', isInProgress);
});

sipConnector.on('auto-connect:before-attempt', () => {
  console.log('–ù–∞—á–∞–ª–æ –ø–æ–ø—ã—Ç–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è');
});

sipConnector.on('auto-connect:succeeded-attempt', () => {
  console.log('–ü–æ–ø—ã—Ç–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–∞');
});

sipConnector.on('auto-connect:failed-attempt', (error) => {
  console.log('–ü–æ–ø—ã—Ç–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –Ω–µ—É–¥–∞—á–Ω–∞:', error);
});

sipConnector.on('auto-connect:cancelled-attempt', (error) => {
  console.log('–ü–æ–ø—ã—Ç–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞:', error);
});

sipConnector.on('auto-connect:connecting', () => {
  console.log('–ù–∞—á–∞–ª–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è');
});

sipConnector.on('auto-connect:connected', (data) => {
  console.log('–£—Å–ø–µ—à–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:', data.isRegistered);
});

sipConnector.on('auto-connect:failed', (error) => {
  console.log('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:', error);
});

sipConnector.on('auto-connect:disconnecting', () => {
  console.log('–ù–∞—á–∞–ª–æ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è');
});

sipConnector.on('auto-connect:disconnected', () => {
  console.log('–û—Ç–∫–ª—é—á–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ');
});
```

### –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã

- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–ø—ã—Ç–∫–∏**: –ü–æ–≤—Ç–æ—Ä—è–µ—Ç –ø–æ–ø—ã—Ç–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∏–∏**: –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è**: –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏ –∑–≤–æ–Ω–∫–æ–≤
- **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏
- **–û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞**: –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –æ—á–∏—Å—Ç–∫—É –∫—ç—à–∞ —á–µ—Ä–µ–∑ —Ö—É–∫

### –°–æ–±—ã—Ç–∏—è –∞–≤—Ç–æ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

| –°–æ–±—ã—Ç–∏–µ                               | –û–ø–∏—Å–∞–Ω–∏–µ                       | –î–∞–Ω–Ω—ã–µ                              |
| ------------------------------------- | ------------------------------ | ----------------------------------- |
| `auto-connect:connecting`             | –ù–∞—á–∞–ª–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è             | -                                   |
| `auto-connect:connected`              | –£—Å–ø–µ—à–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ           | `{ ua: UA, isRegistered: boolean }` |
| `auto-connect:disconnecting`          | –ù–∞—á–∞–ª–æ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è              | -                                   |
| `auto-connect:disconnected`           | –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ           | -                                   |
| `auto-connect:failed`                 | –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è             | `Error`                             |
| `auto-connect:before-attempt`         | –ù–∞—á–∞–ª–æ –ø–æ–ø—ã—Ç–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è     | -                                   |
| `auto-connect:succeeded-attempt`      | –£—Å–ø–µ—à–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è   | -                                   |
| `auto-connect:failed-attempt`         | –ù–µ—É–¥–∞—á–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è  | `Error`                             |
| `auto-connect:cancelled-attempt`      | –û—Ç–º–µ–Ω–µ–Ω–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è | `Error`                             |
| `auto-connect:changed-attempt-status` | –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–ø—ã—Ç–∫–∏      | `{ isInProgress: boolean }`         |

---

## üîß API –∏ —ç–∫—Å–ø–æ—Ä—Ç—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–ª–∞—Å—Å—ã

```typescript
import {
  SipConnector, // –ù–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π API
  SipConnectorFacade, // –í—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π —Ñ–∞—Å–∞–¥
  StatsPeerConnection, // –°–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
  TransceiverManager, // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ transceiver'–∞–º–∏
  // ... –¥—Ä—É–≥–∏–µ —ç–∫—Å–ø–æ—Ä—Ç—ã
} from 'sip-connector';
```

### –ú–µ—Ç–æ–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º

```typescript
// SipConnectorFacade –º–µ—Ç–æ–¥—ã
const facade = new SipConnectorFacade(sipConnector);

// –ó–∞–º–µ–Ω–∞ –º–µ–¥–∏–∞-–ø–æ—Ç–æ–∫–∞
await facade.replaceMediaStream(mediaStream, options);

// –ü–æ–ª—É—á–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤
const streams = facade.getRemoteStreams();

// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ transceiver'–∞–º–∏ (–Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π API)
const transceivers = sipConnector.callManager.getTransceivers();
await sipConnector.callManager.addTransceiver('video', { direction: 'sendrecv' });

// –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ ICE-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (–Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π API)
await sipConnector.callManager.restartIce(options);
```

### –£—Ç–∏–ª–∏—Ç—ã –∏ —Ç–∏–ø—ã

```typescript
import {
  // –£—Ç–∏–ª–∏—Ç—ã
  tools, // getUserAgent, getExtraHeaders, hasPurgatory
  hasAvailableStats, // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

  // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã
  EStatsTypes, // –¢–∏–ø—ã —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
  EMimeTypesVideoCodecs, // MIME-—Ç–∏–ø—ã –∫–æ–¥–µ–∫–æ–≤
  EUseLicense, // –¢–∏–ø—ã –ª–∏—Ü–µ–Ω–∑–∏–π

  // –¢–∏–ø—ã
  type TContentHint, // –ü–æ–¥—Å–∫–∞–∑–∫–∏ –¥–ª—è –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è
  type TInboundStats, // –í—Ö–æ–¥—è—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
  type TOutboundStats, // –ò—Å—Ö–æ–¥—è—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
  type TRestartData, // –î–∞–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è restart
  type ITransceiverStorage, // –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ö—Ä–∞–Ω–µ–Ω–∏—è transceiver'–æ–≤
} from 'sip-connector';
```

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –ø–∞—Ç—Ç–µ—Ä–Ω—ã

### –°–ª–æ–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```shell
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  SipConnectorFacade                ‚îÇ ‚Üê –í—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π API
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                  SipConnector                      ‚îÇ ‚Üê –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Connection ‚îÇ Connection ‚îÇ Call       ‚îÇ  API        ‚îÇ ‚Üê –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ–Ω–µ–¥–∂–µ—Ä—ã
‚îÇ Manager    ‚îÇ Queue      ‚îÇ Manager    ‚îÇ  Manager    ‚îÇ
‚îÇ            ‚îÇ Manager    ‚îÇ            ‚îÇ             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Stats      ‚îÇPresentation‚îÇIncomingCall‚îÇVideoBalancer‚îÇ ‚Üê –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–µ–Ω–µ–¥–∂–µ—Ä—ã
‚îÇ Manager    ‚îÇ Manager    ‚îÇ Manager    ‚îÇ Manager     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                  @krivega/jssip                    ‚îÇ ‚Üê SIP-—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ü–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

| –ü–∞—Ç—Ç–µ—Ä–Ω         | –û–ø–∏—Å–∞–Ω–∏–µ                          | –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ               |
| --------------- | --------------------------------- | ------------------------ |
| **–§–∞—Å–∞–¥**       | –£–ø—Ä–æ—â–µ–Ω–∏–µ —Å–ª–æ–∂–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π        | `SipConnectorFacade`     |
| **–°—Ç—Ä–∞—Ç–µ–≥–∏—è**   | –†–∞–∑–ª–∏—á–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –¥–ª—è –∑–≤–æ–Ω–∫–æ–≤   | MCU, P2P —Ä–µ–∂–∏–º—ã          |
| **–ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å** | –°–æ–±—ã—Ç–∏–π–Ω–∞—è –º–æ–¥–µ–ª—å –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π | Event-driven –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ |
| **–§–∞–±—Ä–∏–∫–∞**     | –°–æ–∑–¥–∞–Ω–∏–µ UA –∏ —Å–µ—Å—Å–∏–π              | `UAFactory`              |

---

## üìö –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

```typescript
try {
  await facade.connectToServer(config);
} catch (error) {
  if (error.code === 'CONNECTION_FAILED') {
    // –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
    await retryConnection();
  } else {
    // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    logError(error);
    notifyUser('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è');
  }
}
```

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

```typescript
// –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
facade.onStats(({ outbound, inbound }) => {
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
  if (outbound.packetsLost > 0.05) {
    // 5% –ø–æ—Ç–µ—Ä—å –ø–∞–∫–µ—Ç–æ–≤
    console.warn('–í—ã—Å–æ–∫–∏–µ –ø–æ—Ç–µ—Ä–∏ –ø–∞–∫–µ—Ç–æ–≤, –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ ICE');

    // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ ICE –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
    sipConnector.callManager
      .restartIce({
        useUpdate: true,
        extraHeaders: ['X-Restart-Reason: High-Packet-Loss'],
      })
      .catch((error) => {
        console.error('–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ ICE:', error);
      });
  }
});
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞–º–∏

```typescript
// –í—Å–µ–≥–¥–∞ –æ—Ç–ø–∏—Å—ã–≤–∞–π—Ç–µ—Å—å –æ—Ç —Å–æ–±—ã—Ç–∏–π
const unsubscribe = facade.onStats(handleStats);

// –û—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
useEffect(() => {
  return () => {
    unsubscribe();
    facade.disconnectFromServer();
  };
}, []);
```

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```typescript
// –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ debounce –¥–ª—è —á–∞—Å—Ç—ã—Ö —Å–æ–±—ã—Ç–∏–π
const debouncedStatsHandler = debounce(handleStats, 1000);
facade.onStats(debouncedStatsHandler);

// –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä—É–π—Ç–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–æ–¥–µ–∫–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫—É
const sipConnector = new SipConnector(
  { JsSIP: { UA, WebSocketInterface } },
  {
    preferredMimeTypesVideoCodecs: ['video/AV1', 'video/VP9'],
    videoBalancerOptions: {
      ignoreForCodec: 'H264',
      balancingStartDelay: 5000, // –ë—ã—Å—Ç—Ä–µ–µ –∑–∞–ø—É—Å–∫ –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
    },
  },
);
const facade = new SipConnectorFacade(sipConnector);
```

---

## üêõ –û—Ç–ª–∞–¥–∫–∞ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –í–∫–ª—é—á–µ–Ω–∏–µ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞

```typescript
import { enableDebug, disableDebug } from 'sip-connector';

// –í–∫–ª—é—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
enableDebug();

// –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
disableDebug();
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è

```typescript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
console.log('–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:', facade.isRegistered);

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
console.log('–ù–∞—Å—Ç—Ä–æ–µ–Ω:', facade.isConfigured());

// –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ ICE-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
const checkIceConnection = async () => {
  try {
    const success = await sipConnector.callManager.restartIce({
      useUpdate: true,
      extraHeaders: ['X-Debug: ICE-Check'],
    });
    console.log('ICE —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ:', success ? 'OK' : '–ü—Ä–æ–±–ª–µ–º—ã');
  } catch (error) {
    console.error('ICE –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:', error.message);
  }
};
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
npm test

# –¢–µ—Å—Ç—ã —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
npm run test:coverage

# –¢–µ—Å—Ç—ã –≤ watch —Ä–µ–∂–∏–º–µ
npm run test:watch
```

### –¢–µ—Å—Ç–æ–≤—ã–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã

SDK –≤–∫–ª—é—á–∞–µ—Ç –≥–æ—Ç–æ–≤—ã–µ –º–æ–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

| –ú–æ–∫                     | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ           | –û–ø–∏—Å–∞–Ω–∏–µ                   |
| ----------------------- | -------------------- | -------------------------- |
| `RTCPeerConnectionMock` | WebRTC API           | –ò–º–∏—Ç–∞—Ü–∏—è WebRTC —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π |
| `UA.mock.ts`            | SIP-—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å | –ò–º–∏—Ç–∞—Ü–∏—è SIP User Agent    |
| `BaseSession.mock.ts`   | –°–µ—Å—Å–∏–∏               | –ò–º–∏—Ç–∞—Ü–∏—è SIP —Å–µ—Å—Å–∏–π        |

---

## üåê –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –±—Ä–∞—É–∑–µ—Ä–æ–≤

### WebRTC –ø–æ–¥–¥–µ—Ä–∂–∫–∞

SDK –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ WebRTC API –∏ —Å–æ–≤–º–µ—Å—Ç–∏–º —Å:

| –ë—Ä–∞—É–∑–µ—Ä     | –í–µ—Ä—Å–∏—è | –£—Ä–æ–≤–µ–Ω—å –ø–æ–¥–¥–µ—Ä–∂–∫–∏ | –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                    |
| ----------- | ------ | ----------------- | ------------------------------ |
| **Chrome**  | 67+    | –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞  | –í—Å–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ WebRTC         |
| **Firefox** | 60+    | –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞  | –í—Å–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ WebRTC         |
| **Safari**  | 11+    | –ë–∞–∑–æ–≤–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–æ–¥–µ–∫–æ–≤ |
| **Edge**    | 79+    | –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞  | Chromium-based                 |

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π

```typescript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ WebRTC
if (!navigator.mediaDevices?.getUserMedia) {
  throw new Error('WebRTC –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π
if (!navigator.mediaDevices?.getDisplayMedia) {
  console.warn('Screen sharing –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ ICE restart
if (!RTCPeerConnection.prototype.restartIce) {
  console.warn('ICE restart –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ —ç—Ç–æ–º –±—Ä–∞—É–∑–µ—Ä–µ');
}
```

---

## ü§ù –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **API Reference**: –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö –º–µ—Ç–æ–¥–æ–≤ –∏ —Ç–∏–ø–æ–≤
- **–ü—Ä–∏–º–µ—Ä—ã**: –ì–æ—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

### –°–æ–æ–±—â–µ—Å—Ç–≤–æ

- **Issues**: [GitHub Issues](https://github.com/Krivega/sip-connector/issues)
- **Discussions**: –û–±—Å—É–∂–¥–µ–Ω–∏—è –∏ –≤–æ–ø—Ä–æ—Å—ã
- **Contributing**: –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —É—á–∞—Å—Ç–∏—é –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

## üë®‚Äçüíª –ê–≤—Ç–æ—Ä

### Krivega Dmitriy

- üåê Website: [krivega.com](https://krivega.com)
- üì± Github: [@Krivega](https://github.com/Krivega)
- üìß Email: <mr.krivega@gmail.com>

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

Copyright ¬© 2021‚Äë2025 [Krivega Dmitriy](https://github.com/Krivega).

This project is licensed under the [MIT License](https://github.com/Krivega/sip-connector/blob/master/LICENSE) - see the LICENSE file for details.
